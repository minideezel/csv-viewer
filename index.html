<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CSV Viewer</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- React and ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- PapaParse for CSV parsing -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    .sortable {
      cursor: pointer;
      user-select: none;
    }
    .arrow {
      font-size: 0.8em;
      margin-left: 4px;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-5">
    <h1 class="mb-4 text-center">CSV Viewer</h1>
    <div id="root"></div>
  </div>
  <script type="text/babel">
    function CSVTable() {
      const [data, setData] = React.useState([]);
      const [headers, setHeaders] = React.useState([]);
      const [sortConfig, setSortConfig] = React.useState({ key: null, direction: 'asc' });
      const [search, setSearch] = React.useState("");

      const handleFileUpload = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        Papa.parse(file, {
          header: true,
          skipEmptyLines: true,
          complete: (results) => {
            setHeaders(results.meta.fields);
            setData(results.data);
            setSortConfig({ key: null, direction: 'asc' });
          },
        });
      };

      const sortData = (key) => {
        let direction = 'asc';
        if (sortConfig.key === key && sortConfig.direction === 'asc') {
          direction = 'desc';
        }
        setSortConfig({ key, direction });
        setData((prevData) => {
          const sorted = [...prevData].sort((a, b) => {
            if (a[key] === undefined || b[key] === undefined) return 0;
            if (!isNaN(a[key]) && !isNaN(b[key])) {
              return direction === 'asc' ? a[key] - b[key] : b[key] - a[key];
            }
            return direction === 'asc'
              ? String(a[key]).localeCompare(String(b[key]))
              : String(b[key]).localeCompare(String(a[key]));
          });
          return sorted;
        });
      };

      const renderArrow = (key) => {
        if (sortConfig.key !== key) return null;
        return sortConfig.direction === 'asc' ? (
          <span className="arrow">▲</span>
        ) : (
          <span className="arrow">▼</span>
        );
      };

      // Filtered data based on search
      const filteredData = React.useMemo(() => {
        if (!search) return data;
        const lower = search.toLowerCase();
        return data.filter(row =>
          headers.some(h => String(row[h] || "").toLowerCase().includes(lower))
        );
      }, [search, data, headers]);

      return (
        <div>
          <div className="mb-3">
            <input type="file" accept=".csv" className="form-control" onChange={handleFileUpload} />
          </div>
          {data.length > 0 && (
            <>
              <div className="mb-3">
                <input
                  type="text"
                  className="form-control"
                  placeholder="Search..."
                  value={search}
                  onChange={e => setSearch(e.target.value)}
                />
              </div>
              <div className="table-responsive">
                <table className="table table-bordered table-hover bg-white">
                  <thead className="table-light">
                    <tr>
                      {headers.map((header) => (
                        <th
                          key={header}
                          className="sortable"
                          onClick={() => sortData(header)}
                        >
                          {header} {renderArrow(header)}
                        </th>
                      ))}
                    </tr>
                  </thead>
                  <tbody>
                    {filteredData.map((row, idx) => (
                      <tr key={idx}>
                        {headers.map((header) => (
                          <td key={header}>{row[header]}</td>
                        ))}
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<CSVTable />);
  </script>
</body>
</html>
